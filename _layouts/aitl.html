<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>{{ page.title | default: site.title }}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Minimal layout: 本文のみ。表の罫線とMermaidだけ最低限サポート -->

  <style>
    /* ===== Base ===== */
    :root { --text:#111; --bg:#fff; --link:#0b3d75; }
    html, body { margin:0; padding:0; background:var(--bg); color:var(--text); }
    .page-content { max-width:980px; margin:16px auto; padding:0 14px; }
    h1, h2, h3 {
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue",
                   Arial, "Hiragino Sans", "Yu Gothic", sans-serif;
      line-height: 1.3;
      margin: 1rem 0 .6rem;
    }
    a { color: var(--link); text-decoration: none; }
    a:hover { text-decoration: underline; }
    img { max-width:100%; height:auto; }

    /* ===== Tables: 枠線を必ず表示 ===== */
    table { border-collapse: collapse; width: 100%; margin: .8rem 0; }
    th, td {
      border: 1px solid #8aa9c9;
      padding: 6px 10px;
      vertical-align: top;
    }
    th {
      background: #eef5fb;
      font-weight: 700;
      white-space: nowrap;
      text-align: left;
    }

    /* Mermaid 図の中央寄せ（このレイアウト内だけで完結） */
    .mermaid {
      display: block;
      margin: 1.5rem auto;
      max-width: 960px;
      text-align: center;
    }

    @media (max-width:640px){
      th, td { padding: 6px 8px; }
    }
    @media print {
      thead { display: table-header-group; }
      tr, img, table, pre { break-inside: avoid; page-break-inside: avoid; }
    }
  </style>

  <!-- Mermaid 本体（Pagesでのみ動作。GitHub本体のREADMEには効きません） -->
  <script defer src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
</head>
<body>
  <main class="page-content">
    {{ content }}
  </main>

  <!-- Mermaid 初期化：```mermaid → <div class="mermaid"> 置換 + ライト固定 + 中央寄せ -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      // 1) Jekyllが吐く <code class="language-mermaid"> を <div class="mermaid"> に差し替え
      document.querySelectorAll('code.language-mermaid').forEach(function (code) {
        const pre = code.closest('pre');
        const div = document.createElement('div');
        div.className = 'mermaid';
        div.textContent = code.textContent;  // グラフ記述をそのまま移す
        (pre || code).replaceWith(div);
      });

      // 2) ライト固定で初期化（黒ボックス回避）
      if (window.mermaid) {
        mermaid.initialize({
          startOnLoad: true,
          securityLevel: 'loose',
          theme: 'default'
        });
      }
    });
  </script>
</body>
</html>
